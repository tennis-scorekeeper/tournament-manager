<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Welcome to Firebase Hosting</title>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <!-- update the version number as needed -->
    <script defer src="/__/firebase/6.0.4/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/6.0.4/firebase-auth.js"></script>
    <script defer src="/__/firebase/6.0.4/firebase-database.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
  </head>
  <body>
    <div id="bracketNameHolder">
      <h2 id="drawName"></h2>
    </div>
    <p id="savingProgress"></p>
    <div id="bracket">
      <img height="2500" width="2500" id="bracket" src="images/32b.png">

      <p id="round1Left">Round of 32</p>
      <p id="round2Left">Round of 16</p>
      <p id="round3Left">Quarterfinals</p>
      <p id="round4Left">Semifinals</p>
      <p id="round5Left">Finals</p>
      <select id="m0a" onchange="saveDraw2('m0', 'm0a')">
          <option>Bye</option>
      </select>
      <select id="m0b" onchange="saveDraw2('m0', 'm0b')">
          <option>Bye</option>
      </select>
      <button id="m0" class="editMatch" onclick="editMatch('m0')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m0details" class="matchDetailsLeft"></p>
      <p id="m0score" class="matchScore"></p>

      <select id="m1a" onchange="saveDraw2('m1', 'm1a')">
          <option>Bye</option>
      </select>
      <select id="m1b" onchange="saveDraw2('m1', 'm1b')">
          <option>Bye</option>
      </select>
      <button id="m1" class="editMatch" onclick="editMatch('m1')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m1details" class="matchDetailsLeft"></p>
      <p id="m1score" class="matchScore"></p>

      <select id="m2a" onchange="saveDraw2('m2', 'm2a')">
          <option>Bye</option>
      </select>
      <select id="m2b" onchange="saveDraw2('m2', 'm2b')">
          <option>Bye</option>
      </select>
      <button id="m2" class="editMatch" onclick="editMatch('m2')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m2details" class="matchDetailsLeft"></p>
      <p id="m2score" class="matchScore"></p>

      <select id="m3a" onchange="saveDraw2('m3', 'm3a')">
          <option>Bye</option>
      </select>
      <select id="m3b" onchange="saveDraw2('m3', 'm3b')">
          <option>Bye</option>
      </select>
      <button id="m3" class="editMatch" onclick="editMatch('m3')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m3details" class="matchDetailsLeft"></p>
      <p id="m3score" class="matchScore"></p>

      <select id="m4a" onchange="saveDraw2('m4', 'm4a')">
          <option>Bye</option>
      </select>
      <select id="m4b" onchange="saveDraw2('m4', 'm4b')">
          <option>Bye</option>
      </select>
      <button id="m4" class="editMatch" onclick="editMatch('m4')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m4details" class="matchDetailsLeft"></p>
      <p id="m4score" class="matchScore"></p>

      <select id="m5a" onchange="saveDraw2('m5', 'm5a')">
          <option>Bye</option>
      </select>
      <select id="m5b" onchange="saveDraw2('m5', 'm5b')">
          <option>Bye</option>
      </select>
      <button id="m5" class="editMatch" onclick="editMatch('m5')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m5details" class="matchDetailsLeft"></p>
      <p id="m5score" class="matchScore"></p>

      <select id="m6a" onchange="saveDraw2('m6', 'm6a')">
          <option>Bye</option>
      </select>
      <select id="m6b" onchange="saveDraw2('m6', 'm6b')">
          <option>Bye</option>
      </select>
      <button id="m6" class="editMatch" onclick="editMatch('m6')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m6details" class="matchDetailsLeft"></p>
      <p id="m6score" class="matchScore"></p>

      <select id="m7a" onchange="saveDraw2('m7', 'm7a')">
          <option>Bye</option>
      </select>
      <select id="m7b" onchange="saveDraw2('m7', 'm7b')">
          <option>Bye</option>
      </select>
      <button id="m7" class="editMatch" onclick="editMatch('m7')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m7details" class="matchDetailsLeft"></p>
      <p id="m7score" class="matchScore"></p>

      <select id="m8a" onchange="saveDraw2('m8', 'm8a')">
          <option>Bye</option>
      </select>
      <select id="m8b" onchange="saveDraw2('m8', 'm8b')">
          <option>Bye</option>
      </select>
      <button id="m8" class="editMatch" onclick="editMatch('m8')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m8details" class="matchDetailsLeft"></p>
      <p id="m8score" class="matchScore"></p>

      <select id="m9a" onchange="saveDraw2('m9', 'm9a')">
          <option>Bye</option>
      </select>
      <select id="m9b" onchange="saveDraw2('m9', 'm9b')">
          <option>Bye</option>
      </select>
      <button id="m9" class="editMatch" onclick="editMatch('m9')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m9details" class="matchDetailsLeft"></p>
      <p id="m9score" class="matchScore"></p>

      <select id="m10a" onchange="saveDraw2('m10', 'm10a')">
          <option>Bye</option>
      </select>
      <select id="m10b" onchange="saveDraw2('m10', 'm10b')">
          <option>Bye</option>
      </select>
      <button id="m10" class="editMatch" onclick="editMatch('m10')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m10details" class="matchDetailsLeft"></p>
      <p id="m10score" class="matchScore"></p>

      <select id="m11a" onchange="saveDraw2('m11', 'm11a')">
          <option>Bye</option>
      </select>
      <select id="m11b" onchange="saveDraw2('m11', 'm11b')">
          <option>Bye</option>
      </select>
      <button id="m11" class="editMatch" onclick="editMatch('m11')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m11details" class="matchDetailsLeft"></p>
      <p id="m11score" class="matchScore"></p>

      <select id="m12a" onchange="saveDraw2('m12', 'm12a')">
          <option>Bye</option>
      </select>
      <select id="m12b" onchange="saveDraw2('m12', 'm12b')">
          <option>Bye</option>
      </select>
      <button id="m12" class="editMatch" onclick="editMatch('m12')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m12details" class="matchDetailsLeft"></p>
      <p id="m12score" class="matchScore"></p>

      <select id="m13a" onchange="saveDraw2('m13', 'm13a')">
          <option>Bye</option>
      </select>
      <select id="m13b" onchange="saveDraw2('m13', 'm13b')">
          <option>Bye</option>
      </select>
      <button id="m13" class="editMatch" onclick="editMatch('m13')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m13details" class="matchDetailsLeft"></p>
      <p id="m13score" class="matchScore"></p>

      <select id="m14a" onchange="saveDraw2('m14', 'm14a')">
          <option>Bye</option>
      </select>
      <select id="m14b" onchange="saveDraw2('m14', 'm14b')">
          <option>Bye</option>
      </select>
      <button id="m14" class="editMatch" onclick="editMatch('m14')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m14details" class="matchDetailsLeft"></p>
      <p id="m14score" class="matchScore"></p>

      <select id="m15a" onchange="saveDraw2('m15', 'm15a')">
          <option>Bye</option>
      </select>
      <select id="m15b" onchange="saveDraw2('m15', 'm15b')">
          <option>Bye</option>
      </select>
      <button id="m15" class="editMatch" onclick="editMatch('m15')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m15details" class="matchDetailsLeft"></p>
      <p id="m15score" class="matchScore"></p>

      <span id="m16a"></span>
      <span id="m16b"></span>
      <button id="m16" class="editMatch" onclick="editMatch('m16')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m16details" class="matchDetailsLeft"></p>
      <p id="m16score" class="matchScore"></p>

      <span id="m17a"></span>
      <span id="m17b"></span>
      <button id="m17" class="editMatch" onclick="editMatch('m17')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m17details" class="matchDetailsLeft"></p>
      <p id="m17score" class="matchScore"></p>
      
      <span id="m18a"></span>
      <span id="m18b"></span>
      <button id="m18" class="editMatch" onclick="editMatch('m18')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m18details" class="matchDetailsLeft"></p>
      <p id="m18score" class="matchScore"></p>

      <span id="m19a"></span>
      <span id="m19b"></span>
      <button id="m19" class="editMatch" onclick="editMatch('m19')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m19details" class="matchDetailsLeft"></p>
      <p id="m19score" class="matchScore"></p>

      <span id="m20a"></span>
      <span id="m20b"></span>
      <button id="m20" class="editMatch" onclick="editMatch('m20')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m20details" class="matchDetailsLeft"></p>
      <p id="m20score" class="matchScore"></p>

      <span id="m21a"></span>
      <span id="m21b"></span>
      <button id="m21" class="editMatch" onclick="editMatch('m21')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m21details" class="matchDetailsLeft"></p>
      <p id="m21score" class="matchScore"></p>

      <span id="m22a"></span>
      <span id="m22b"></span>
      <button id="m22" class="editMatch" onclick="editMatch('m22')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m22details" class="matchDetailsLeft"></p>
      <p id="m22score" class="matchScore"></p>

      <span id="m23a"></span>
      <span id="m23b"></span>
      <button id="m23" class="editMatch" onclick="editMatch('m23')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m23details" class="matchDetailsLeft"></p>
      <p id="m23score" class="matchScore"></p>

      <span id="m24a"></span>
      <span id="m24b"></span>
      <button id="m24" class="editMatch" onclick="editMatch('m24')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m24details" class="matchDetailsLeft"></p>
      <p id="m24score" class="matchScore"></p>

      <span id="m25a"></span>
      <span id="m25b"></span>
      <button id="m25" class="editMatch" onclick="editMatch('m25')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m25details" class="matchDetailsLeft"></p>
      <p id="m25score" class="matchScore"></p>

      <span id="m26a"></span>
      <span id="m26b"></span>
      <button id="m26" class="editMatch" onclick="editMatch('m26')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m26details" class="matchDetailsLeft"></p>
      <p id="m26score" class="matchScore"></p>

      <span id="m27a"></span>
      <span id="m27b"></span>
      <button id="m27" class="editMatch" onclick="editMatch('m27')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m27details" class="matchDetailsLeft"></p>
      <p id="m27score" class="matchScore"></p>

      <span id="m28a"></span>
      <span id="m28b"></span>
      <button id="m28" class="editMatch" onclick="editMatch('m28')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m28details" class="matchDetailsLeft"></p>
      <p id="m28score" class="matchScore"></p>

      <span id="m29a"></span>
      <span id="m29b"></span>
      <button id="m29" class="editMatch" onclick="editMatch('m29')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m29details" class="matchDetailsLeft"></p>
      <p id="m29score" class="matchScore"></p>

      <span id="m30a"></span>
      <span id="m30b"></span>
      <button id="m30" class="editMatch" onclick="editMatch('m30')" data-toggle="modal" data-target="#editMatchModal"></button>
      <p id="m30details" class="matchDetailsLeft"></p>
      <p id="m30score" class="matchScore"></p>

      <span id="winner"></span>
    </div>

    <div class="modal fade" id="editMatchModal" tabindex="-1" role="dialog" aria-labelledby="editMatchModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editMatchModalLabel">
            Edit Match
          </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
          <div class="col-6" id="editMatchLocationHolder">
            <select id="editMatchLocationSelect">
              <option value="">Choose a Location</option>
            </select>
          </div>
          <div class="col-6" id="editMatchDateHolder">
            <input type="date" id="editMatchDate" />
          </div>
          </div>
          <div class="row">
            <div class="col-8">
              
              <input id="p1" type="radio" name="matchWinner">
              <label id="p1Label" class="matchWinner" for="p1">Player 1</label><br>
              <input id="p2" type="radio" name="matchWinner">
              <label id="p2Label" class="matchWinner" for="p2">Player 2</label><br>
            </div>
            <div class="col-4">
              <div>
                <input id="p1s1" class="scoreInput" type="number"/>
                <input id="p1s2" class="scoreInput" type="number"/>
                <input id="p1s3" class="scoreInput" type="number"/>
              </div>
              <div>
                  <input id="p2s1" class="scoreInput" type="number"/>
                  <input id="p2s2" class="scoreInput" type="number"/>
                  <input id="p2s3" class="scoreInput" type="number"/>
                </div>
            </div>
          </div>
          <div style="text-align: center">
            <label for="matchCourtNumber">Court</label>
            <input type="number" id="matchCourtNumber"/>
            <label for="matchTime">Time</label>
            <input type="time" id="matchTime" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="saveMatch()">
              Save
            </button>
        </div>
      </div>
    </div>
  </div>
  </body>

  <script type="text/javascript" src="js/util.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      try {
        firebase.auth().onAuthStateChanged(function (user) {
          if (user) {
            if (!user.emailVerified) {
              window.location.replace("/");
            } else {
              loadDraw();
            }
          } else {
            window.location.replace("/");
          }
        });
      } catch (e) {
        console.error(e);
      }
    });

    function loadDraw() {
      var url = window.location.href.substring(
        window.location.href.indexOf("?")
      );
      var params = new URLSearchParams(url);
      var tournamentId = params.get("tournamentId");
      var divName = params.get("div");
      document.getElementById("drawName").textContent = divName;

      var rootRef = firebase.database().ref();
      var tournamentsRef = rootRef.child("tournaments");
      var tournamentRef = tournamentsRef.child(tournamentId);
      var divRef = tournamentRef.child("divisions").child(divName);

      var round1LeftMatchIds1 = 
        ["m0", "m1", "m2","m3","m4", "m5", "m6", "m7"];
      var round1LeftMatchIds2 =
        ["m8", "m9", "m10","m11","m12", "m13", "m14", "m15"];
      var round1MatchInc = 74;
      var round1PlayerInc = 78;
      var counter = 57;

      var editButtonCounter = 117;
      var editButtonInc = 152;

      for (var i = 0; i < round1LeftMatchIds1.length; i++) {
        document.getElementById(round1LeftMatchIds1[i]+"a").setAttribute("style", "position:absolute;left:10px;top:"+counter+"px;");
        document.getElementById(round1LeftMatchIds1[i]).setAttribute("style", "position:absolute;left:190px;padding:7px;top:"+editButtonCounter+"px;");
        document.getElementById(round1LeftMatchIds1[i]+"details").setAttribute("style", "position:absolute;left:0px;padding:7px;top:"+(editButtonCounter-15)+"px;width:12em;");
        document.getElementById(round1LeftMatchIds1[i]+"score").setAttribute("style", "position:absolute;left:240px;padding:7px;top:"+(editButtonCounter+8)+"px;width:6em;");
        
        editButtonCounter += editButtonInc;
        counter += round1PlayerInc;
        document.getElementById(round1LeftMatchIds1[i]+"b").setAttribute("style", "position:absolute;left:10px;top:"+counter+"px;");

        counter += round1MatchInc;
        if (i == 5) {
          counter += 3;
        }
      }
      counter = 1325;
      editButtonCounter = 1385;
      for (var i = 0; i < round1LeftMatchIds1.length; i++) {
        document.getElementById(round1LeftMatchIds2[i]+"a").setAttribute("style", "position:absolute;left:10px;top:"+counter+"px;");
        document.getElementById(round1LeftMatchIds2[i]).setAttribute("style", "position:absolute;left:190px;padding:7px;top:"+editButtonCounter+"px;");
        document.getElementById(round1LeftMatchIds2[i]+"details").setAttribute("style", "position:absolute;left:0px;padding:7px;top:"+(editButtonCounter-15)+"px;width:12em;");
        document.getElementById(round1LeftMatchIds2[i]+"score").setAttribute("style", "position:absolute;left:240px;padding:7px;top:"+(editButtonCounter+8)+"px;width:6em;");

        editButtonCounter += editButtonInc;

        counter += round1PlayerInc;
        document.getElementById(round1LeftMatchIds2[i]+"b").setAttribute("style", "position:absolute;left:10px;top:"+counter+"px;");

        counter += round1MatchInc;
        if (i == 5) {
          counter += 3;
        }
      }

      var round2LeftMatchIds1 = 
        ["m16", "m17", "m18","m19"];
      var round2LeftMatchIds2 =
        ["m20", "m21", "m22","m23"];

      var topCounter = 100;
      var botCounter = 1365;
      var editTopCounter = 190;
      var editBotCounter = 1458;

      var playerInc = 155;
      var matchInc = 150;
      var editInc = 305;

      for (var i = 0; i < round2LeftMatchIds1.length; i++) {
        document.getElementById(round2LeftMatchIds1[i]+"a").setAttribute("style", "position:absolute;left:248px;top:"+topCounter+"px;width:11em;");
        document.getElementById(round2LeftMatchIds1[i]).setAttribute("style", "position:absolute;left:400px;padding:7px;top:"+editTopCounter+"px;");
        document.getElementById(round2LeftMatchIds1[i]+"details").setAttribute("style", "position:absolute;left:205px;padding:7px;top:"+(editTopCounter-15)+"px;width:12em;");
        document.getElementById(round2LeftMatchIds1[i]+"score").setAttribute("style", "position:absolute;left:440px;padding:7px;top:"+(editTopCounter+8)+"px;width:6em;");
        
        document.getElementById(round2LeftMatchIds2[i]+"a").setAttribute("style", "position:absolute;left:248px;top:"+botCounter+"px;width:11em;");
        document.getElementById(round2LeftMatchIds2[i]).setAttribute("style", "position:absolute;left:400px;padding:7px;top:"+editBotCounter+"px;");
        document.getElementById(round2LeftMatchIds2[i]+"details").setAttribute("style", "position:absolute;left:205px;padding:7px;top:"+(editBotCounter-15)+"px;width:12em;");
        document.getElementById(round2LeftMatchIds2[i]+"score").setAttribute("style", "position:absolute;left:440px;padding:7px;top:"+(editBotCounter+8)+"px;width:6em;");

        editTopCounter += editInc;
        editBotCounter += editInc;

        topCounter += playerInc;
        botCounter += playerInc;
        document.getElementById(round2LeftMatchIds1[i]+"b").setAttribute("style", "position:absolute;left:248px;top:"+topCounter+"px;width:11em;");
        document.getElementById(round2LeftMatchIds2[i]+"b").setAttribute("style", "position:absolute;left:248px;top:"+botCounter+"px;width:11em;");

        topCounter += matchInc;
        botCounter += matchInc;
        if (i == 5) {
          counter += 3;
        }
      }

      var round3LeftMatchIds1 = 
        ["m24", "m25"];
      var round3LeftMatchIds2 =
        ["m26", "m27"];

      var topCounter = 175;
      var botCounter = 1443;
      var editTopCounter = 347;
      var editBotCounter = 1608;

      var playerInc = 305;
      var matchInc = 308;
      var editInc = 616;

      for (var i = 0; i < round3LeftMatchIds1.length; i++) {
        document.getElementById(round3LeftMatchIds1[i]+"a").setAttribute("style", "position:absolute;left:448px;top:"+topCounter+"px;width:11em;");
        document.getElementById(round3LeftMatchIds1[i]).setAttribute("style", "position:absolute;left:600px;padding:7px;top:"+editTopCounter+"px;");
        document.getElementById(round3LeftMatchIds1[i]+"details").setAttribute("style", "position:absolute;left:405px;padding:7px;top:"+(editTopCounter-15)+"px;width:12em;");
        document.getElementById(round3LeftMatchIds1[i]+"score").setAttribute("style", "position:absolute;left:640px;padding:7px;top:"+(editTopCounter+8)+"px;width:6em;");
        
        document.getElementById(round3LeftMatchIds2[i]+"a").setAttribute("style", "position:absolute;left:448px;top:"+botCounter+"px;width:11em;");
        document.getElementById(round3LeftMatchIds2[i]).setAttribute("style", "position:absolute;left:600px;padding:7px;top:"+editBotCounter+"px;");
        document.getElementById(round3LeftMatchIds2[i]+"details").setAttribute("style", "position:absolute;left:405px;padding:7px;top:"+(editBotCounter-15)+"px;width:12em;");
        document.getElementById(round3LeftMatchIds2[i]+"score").setAttribute("style", "position:absolute;left:640px;padding:7px;top:"+(editBotCounter+8)+"px;width:6em;");
   
        editTopCounter += editInc;
        editBotCounter += editInc;

        topCounter += playerInc;
        botCounter += playerInc;
        document.getElementById(round3LeftMatchIds1[i]+"b").setAttribute("style", "position:absolute;left:448px;top:"+topCounter+"px;width:11em;");
        document.getElementById(round3LeftMatchIds2[i]+"b").setAttribute("style", "position:absolute;left:448px;top:"+botCounter+"px;width:11em;");

        topCounter += matchInc;
        botCounter += matchInc;
        if (i == 5) {
          counter += 3;
        }
      }

      var round4LeftMatchIds1 = 
        ["m28"];
      var round4LeftMatchIds2 =
        ["m29"];

      var topCounter = 330;
      var botCounter = 1590;
      var editTopCounter = 650;
      var editBotCounter = 1950;

      var playerInc = 613;
      var matchInc = 308;
      var editInc = 616;

      for (var i = 0; i < round4LeftMatchIds1.length; i++) {
        document.getElementById(round4LeftMatchIds1[i]+"a").setAttribute("style", "position:absolute;left:648px;top:"+topCounter+"px;width:11em;");
        document.getElementById(round4LeftMatchIds1[i]).setAttribute("style", "position:absolute;left:780px;padding:7px;top:"+editTopCounter+"px;");
        document.getElementById(round4LeftMatchIds1[i]+"details").setAttribute("style", "position:absolute;left:585px;padding:7px;top:"+(editTopCounter-15)+"px;width:12em;");
        document.getElementById(round4LeftMatchIds1[i]+"score").setAttribute("style", "position:absolute;left:815px;padding:7px;top:"+(editTopCounter+8)+"px;width:6em;");
        
        document.getElementById(round4LeftMatchIds2[i]+"a").setAttribute("style", "position:absolute;left:648px;top:"+botCounter+"px;width:11em;");
        document.getElementById(round4LeftMatchIds2[i]).setAttribute("style", "position:absolute;left:780px;padding:7px;top:"+editBotCounter+"px;");
        document.getElementById(round4LeftMatchIds2[i]+"details").setAttribute("style", "position:absolute;left:585px;padding:7px;top:"+(editBotCounter-15)+"px;width:12em;");
        document.getElementById(round4LeftMatchIds2[i]+"score").setAttribute("style", "position:absolute;left:815px;padding:7px;top:"+(editBotCounter+8)+"px;width:6em;");

        editTopCounter += editInc;
        editBotCounter += editInc;

        topCounter += playerInc;
        botCounter += playerInc;
        document.getElementById(round4LeftMatchIds1[i]+"b").setAttribute("style", "position:absolute;left:648px;top:"+topCounter+"px;width:11em;");
        document.getElementById(round4LeftMatchIds2[i]+"b").setAttribute("style", "position:absolute;left:648px;top:"+botCounter+"px;width:11em;");

        topCounter += matchInc;
        botCounter += matchInc;
        if (i == 5) {
          counter += 3;
        }
      }

      document.getElementById("m30a").setAttribute("style", "position:absolute;left:823px;top:"+633+"px;width:11em;");
      document.getElementById("m30b").setAttribute("style", "position:absolute;left:823px;top:"+1933+"px;width:11em;");
      document.getElementById("m30").setAttribute("style", "position:absolute;left:945px;padding:7px;top:"+1298+"px;");
      document.getElementById("m30details").setAttribute("style", "position:absolute;left:750px;padding:7px;top:"+1283+"px;width:12em;");
      document.getElementById("m30score").setAttribute("style", "position:absolute;left:985px;padding:7px;top:"+1310+"px;width:6em;");

      document.getElementById("winner").setAttribute("style", "position:absolute;left:993px;top:"+1282+"px;width:11em;");
    
      var fullMatchIds = 
        ["m0", "m1", "m2","m3","m4", "m5", "m6", "m7",
        "m8", "m9", "m10","m11","m12", "m13", "m14", "m15"];

        var fullMatchIds2 = 
        ["m16", "m17", "m18","m19","m20", "m21", "m22", "m23",
        "m24", "m25", "m26","m27","m28", "m29", "m30"];

      var matchIds = 
        ["m0a", "m0b", "m1a", "m1b", "m2a", "m2b", "m3a", "m3b",
        "m4a", "m4b", "m5a", "m5b", "m6a", "m6b", "m7a", "m7b",
        "m8a", "m8b", "m9a", "m9b", "m10a", "m10b", "m11a", "m11b",
        "m12a", "m12b", "m13a", "m13b", "m14a", "m14b", "m15a", "m15b"]

      var playerOptionElements = [];
      divRef.once("value").then(ss => {
        var playersList = ss.child("players").val();

        matchIds.forEach(id => {
          playersList.forEach(player => {
            var optionElement = document.createElement("option");
            optionElement.textContent = formatPlayerNameDraw(player);
            optionElement.setAttribute("value", player);
            document.getElementById(id).appendChild(optionElement);
          })
        })
        fullMatchIds.forEach(id => {
          document.getElementById(id+"a").value = ss.child("draw").child(id).child(id+"a").val();
          document.getElementById(id+"b").value = ss.child("draw").child(id).child(id+"b").val();
          var detailString = "";
          var date = ss.child("draw").child(id).child("date").val();
          var time = ss.child("draw").child(id).child("matchTime").val()
          var location = ss.child("draw").child(id).child("location").val();

          if (date != null && date != "") {
            detailString += date.substring(date.indexOf("-")+1) + " ";
          }
          if (time != null && time != "") {
            detailString += time + " ";
          }
          if (location != null && location != "") {
            detailString += location.substring(location.indexOf(" - ") + 3);
          }
          document.getElementById(id+"details").textContent = detailString;

          var score = ss.child("draw").child(id).child("score").val();
          var scoreString = "";
          if (score != null) {
            score.split(" ").forEach(set => {
              if (set.length == 3) {
                scoreString += set + " ";
              }
            });
          }
          document.getElementById(id+"score").textContent = scoreString;
        })
        fullMatchIds2.forEach(id => {
          document.getElementById(id+"a").textContent = formatPlayerNameDrawShorten(ss.child("draw").child(id).child(id+"a").val());
          document.getElementById(id+"b").textContent = formatPlayerNameDrawShorten(ss.child("draw").child(id).child(id+"b").val());
          var detailString = "";
          var date = ss.child("draw").child(id).child("date").val();
          var time = ss.child("draw").child(id).child("matchTime").val()
          var courtNumber = ss.child("draw").child(id).child("courtNumber").val();
          var location = ss.child("draw").child(id).child("location").val();

          if (date != null && date != "") {
            detailString += date.substring(date.indexOf("-")+1) + " ";
          }
          if (time != null && time != "") {
            detailString += time + " ";
          }
          if (location != null && location != "") {
            detailString += location.substring(location.indexOf(" - ") + 3);
          }
          document.getElementById(id+"details").textContent = detailString;

          var score = ss.child("draw").child(id).child("score").val();
          var scoreString = "";
          if (score != null) {
            score.split(" ").forEach(set => {
              if (set.length == 3) {
                scoreString += set + " ";
              }
            });
          }
          document.getElementById(id+"score").textContent = scoreString;
        })
        document.getElementById("winner").textContent = ss.child("draw").child("winne").val().winner;
      })

      tournamentRef.once("value").then(tss => {
        tss.child("locations").forEach(location => {
          var optElement = document.createElement("option");
          optElement.textContent = location.key.replace(",", ".") + " - " + location.child("abbrev").val();
          optElement.setAttribute("value", location.key + " - " + location.child("abbrev").val());
          document.getElementById("editMatchLocationSelect").appendChild(optElement);
        })
      
      })
    }

    function saveDraw2(matchId, matchPlayerId) {
      document.getElementById("savingProgress").textContent = "Saving..."
      var url = window.location.href.substring(
        window.location.href.indexOf("?")
      );
      var params = new URLSearchParams(url);
      var tournamentId = params.get("tournamentId");
      var divName = params.get("div");
      document.getElementById("drawName").textContent = divName;

      var rootRef = firebase.database().ref();
      var tournamentsRef = rootRef.child("tournaments");
      var divRef = tournamentsRef.child(tournamentId).child("divisions").child(divName);
      var matchNumber = parseInt(matchId.substring(1));

      if (matchNumber < 32) {
        divRef.child("draw").child(matchId).child(matchPlayerId).set(document.getElementById(matchPlayerId).value).then(tmp => {
          document.getElementById("savingProgress").textContent = "Saved!"
        });
      } else {
        divRef.child("draw").child(matchId).child(matchPlayerId).set(document.getElementById(matchPlayerId).textContent).then(tmp => {
          document.getElementById("savingProgress").textContent = "Saved!"
        });
      }
    }

    /*function saveDraw() {
      document.getElementById("savingProgress").textContent = "Saving..."
      var url = window.location.href.substring(
        window.location.href.indexOf("?")
      );
      var params = new URLSearchParams(url);
      var tournamentId = params.get("tournamentId");
      var divName = params.get("div");
      document.getElementById("drawName").textContent = divName;

      var rootRef = firebase.database().ref();
      var tournamentsRef = rootRef.child("tournaments");
      var divRef = tournamentsRef.child(tournamentId).child("divisions").child(divName);

      var fullMatchIds = 
        ["m0", "m1", "m2","m3","m4", "m5", "m6", "m7",
        "m8", "m9", "m10","m11","m12", "m13", "m14", "m15",
        "m16", "m17", "m18","m19","m20", "m21", "m22", "m23",
        "m24", "m25", "m26","m27","m28", "m29", "m30", "m31"];

      var fullMatchIds2 = 
        ["m32", "m33", "m34","m35","m36", "m37", "m38", "m39",
        "m40", "m41", "m42","m43","m44", "m45", "m46", "m47",
        "m48", "m49", "m50","m51","m52", "m53", "m54", "m55",
        "m56", "m57", "m58","m59","m60", "m61", "m62"];

      fullMatchIds.forEach(id => {
        divRef.child("draw").child(id).child(id+"a").set(document.getElementById(id+"a").value);
        divRef.child("draw").child(id).child(id+"b").set(document.getElementById(id+"b").value);
      })
      fullMatchIds2.forEach(id => {
        divRef.child("draw").child(id).child(id+"a").set(document.getElementById(id+"a").textContent);
        divRef.child("draw").child(id).child(id+"b").set(document.getElementById(id+"b").textContent);
      })
      divRef.child("draw").child("winner").set(document.getElementById("winner").textContent);
        
      document.getElementById("savingProgress").textContent = "Saved!"
    }*/

    function editMatch(matchId) {
      var url = window.location.href.substring(
        window.location.href.indexOf("?")
      );
      var params = new URLSearchParams(url);
      var tournamentId = params.get("tournamentId");
      var divName = params.get("div");
      document.getElementById("drawName").textContent = divName;

      var rootRef = firebase.database().ref();
      var tournamentsRef = rootRef.child("tournaments");
      var tournamentRef = tournamentsRef.child(tournamentId);
      var divRef = tournamentRef.child("divisions").child(divName);
      var matchNumber = parseInt(matchId.substring(1));
      document.getElementById("editMatchModalLabel").textContent = matchId;

      if (matchNumber < 32) {
        document.getElementById("p1Label").textContent = document.getElementById(matchId+"a").value
        document.getElementById("p2Label").textContent = document.getElementById(matchId+"b").value
      } else {
        document.getElementById("p1Label").textContent = document.getElementById(matchId+"a").textContent
        document.getElementById("p2Label").textContent = document.getElementById(matchId+"b").textContent
      }
      divRef.once("value").then(ss => {
        var p1 = ss.child("draw").child(matchId).child(matchId+"a").val();
        var p2 = ss.child("draw").child(matchId).child(matchId+"b").val();
        var date = ss.child("draw").child(matchId).child("date").val();
        var time = ss.child("draw").child(matchId).child("matchTime").val()
        var courtNumber = ss.child("draw").child(matchId).child("courtNumber").val();
        var location = ss.child("draw").child(matchId).child("location").val();

        var score = ["-","-","-"];
        if (ss.child("draw").child(matchId).child("score").val() != null) {
          score = ss.child("draw").child(matchId).child("score").val().split(" ");
        }

        document.getElementById("p1Label").textContent = formatPlayerNameDrawEdit(p1);
        document.getElementById("p2Label").textContent = formatPlayerNameDrawEdit(p2);
        document.getElementById("matchCourtNumber").value = courtNumber;
        document.getElementById("matchTime").value = time;
        document.getElementById("editMatchDate").value = date;
        document.getElementById("editMatchLocationSelect").value = location;
        
        if (score[0].length == 3) {
          document.getElementById("p1s1").value = score[0][0];
          document.getElementById("p2s1").value = score[0][2];
        } else {
          document.getElementById("p1s1").value = "";
          document.getElementById("p2s1").value = "";
        }
        if (score[1].length == 3) {
          document.getElementById("p1s2").value = score[1][0];
          document.getElementById("p2s2").value = score[1][2];
        } else {
          document.getElementById("p1s2").value = "";
          document.getElementById("p2s2").value = "";
        }
        if (score[2].length == 3) {
          document.getElementById("p1s3").value = score[2][0];
          document.getElementById("p2s3").value = score[2][2];
        } else {
          document.getElementById("p1s3").value = "";
          document.getElementById("p2s3").value = "";
        }

        var winner = ss.child("draw").child(matchId).child("winner").val();

        if (winner == p1) {
          document.getElementById("p1").checked = true;
        }
        if (winner == p2) {
          document.getElementById("p2").checked = true;
        }
      });
    }

    function saveMatch() {
      var url = window.location.href.substring(
        window.location.href.indexOf("?")
      );
      var params = new URLSearchParams(url);
      var tournamentId = params.get("tournamentId");
      var divName = params.get("div");
      document.getElementById("drawName").textContent = divName;

      var rootRef = firebase.database().ref();
      var tournamentsRef = rootRef.child("tournaments");
      var divRef = tournamentsRef.child(tournamentId).child("divisions").child(divName);

      var matchId = document.getElementById("editMatchModalLabel").textContent;
      var winner = "";
      if (document.getElementById("p1").checked) {
        winner = formatDrawNameToDBFormat(document.getElementById("p1Label").textContent);
      }
      if (document.getElementById("p2").checked) {
        winner = formatDrawNameToDBFormat(document.getElementById("p2Label").textContent);
      }

      var score = document.getElementById("p1s1").value + "-" + document.getElementById("p2s1").value + " " 
        + document.getElementById("p1s2").value + "-" + document.getElementById("p2s2").value + " "
        + document.getElementById("p1s3").value + "-" + document.getElementById("p2s3").value;


      divRef.child("draw").child(matchId).update({
        "winner": winner,
        "score": score,
        "date": document.getElementById("editMatchDate").value,
        "courtNumber": document.getElementById("matchCourtNumber").value,
        "matchTime": document.getElementById("matchTime").value,
        "location": document.getElementById("editMatchLocationSelect").value
      })

      var matchProgressionList = 
        ["m16a","m16b","m17a","m17b","m18a","m18b","m19a","m19b",
        "m20a","m20b","m21a","m21b","m22a","m22b","m23a","m23b",
        "m24a","m24b","m25a","m25b","m26a","m26b","m27a","m27b",
        "m28a","m28b","m29a","m29b","m30a","m30b","winner"];
      document.getElementById(matchProgressionList[parseInt(matchId.substring(1))]).textContent = formatPlayerNameDrawShorten(winner);

      var detailString = "";
      var date = document.getElementById("editMatchDate").value;
      var time = document.getElementById("matchTime").value;
      var courtNumber = document.getElementById("matchCourtNumber").value;
      var location = document.getElementById("editMatchLocationSelect").value;

      if (date != null && date != "") {
        detailString += date.substring(date.indexOf("-")+1) + " ";
      }
      if (time != null && time != "") {
        detailString += time + " ";
      }
      if (location != null && location != "") {
        detailString += location.substring(location.indexOf(" - ") + 3);
      }
      
      var scoreString = "";
      score.split(" ").forEach(set => {
        if (set.length == 3) {
          scoreString += set + " ";
        }
      });
      document.getElementById(matchId+"score").textContent = scoreString;
      document.getElementById(matchId+"details").textContent = detailString;

      var winnerMatchPlayerId = matchProgressionList[parseInt(matchId.substring(1))];
      var matchId = winnerMatchPlayerId.substring(0, winnerMatchPlayerId.length - 1);
      
      divRef.child("draw").child(matchId).child(winnerMatchPlayerId).set(winner).then(tmp => {
        document.getElementById("savingProgress").textContent = "Saved!"
      });
    }

  </script>

  <style>
    #bracketNameHolder {
      margin-top:10px;
      text-align:center;
    }

    #bracket {
      position: absolute;
      top:50px;
    }

    #savingProgress {
      position: absolute;
      top: 25px;
      left: 90px;
    }

    .editMatch {
      background-color: #cfe2f3;
      border: 1px solid black;
    }

    #editMatchDateHolder {
      text-align: right;
    }

    .scoreInput {
      width: 2em;
      height: 2.2em;
      font-size:20px;
      margin-top: 15px;
    }

    .matchWinner {
      margin-top: 20px;
      font-size: 20px;
    }

    #matchCourtNumber {
      margin-top: 20px;
      width: 3em;
      margin-right: 50px;
    }

    #matchTime {
      margin-top: 20px;
      width: 7em;
    }

    .matchDetailsLeft {
      width: 10em;
      text-align: right;
      padding-right: 7px;
    }

    .matchDetailsRight {
      width: 10em;
    }

    .matchDetailsCenter {
      width: 10em;
      text-align: center;
    }

    .matchScore {
      width: 6em;
    }

    .matchScoreCenter {
      width: 6em;
      text-align: center;
    }

    #winner {
      position: absolute;
      left: 825px;
      top: 650px;
    }

    #round1Left {
      position: absolute;
      left: 85px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round2Left {
      position: absolute;
      left: 290px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round3Left {
      position: absolute;
      left: 495px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round4Left {
      position: absolute;
      left: 675px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round5Left {
      position: absolute;
      left: 850px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round6 {
      position: absolute;
      left: 1190px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round1Right {
      position: absolute;
      left: 2330px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round2Right {
      position: absolute;
      left: 2120px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round3Right {
      position: absolute;
      left: 1920px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round4Right {
      position: absolute;
      left: 1725px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }

    #round5Right {
      position: absolute;
      left: 1540px;
      top: 15px;
      width: 7em;
      font-weight: bold;
    }
  </style>
</html>
